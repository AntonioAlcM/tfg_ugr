FROM python:3
# Autor
MAINTAINER Antonio Alcalá Martínez

RUN apt-get update
RUN apt-get install -y rabbitmq-server
RUN apt-get install -y python3-celery
RUN apt-get install -y build-essential tcl
RUN curl -O http://download.redis.io/redis-stable.tar.gz
RUN tar xzvf redis-stable.tar.gz
RUN cd redis-stable && make | make test | make install
RUN mkdir /etc/redis
RUN cp /redis-stable/redis.conf /etc/redis
# Instalación de git y clonado del proyecto
COPY . .
# Instalación de las dependecncias del proyecto

RUN pip3 install -r requirements.txt
EXPOSE 80
CMD systemctl enable rabbitmq-server
CMD systemctl start redis
CMD systemctl start rabbitmq-server
CMD celery -A BuscadorBDMedical worker -l info  && gunicorn BuscadorBDMedical.wsgi --log-file - --bind 0.0.0.0:80
